<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

    <div class="container-fluid mt-5">
        <div class="row">
            <div class="col-md-6">
                <form id="dashboardForm" action="/dashboard" method="GET">
                    <div class="form-group">
                        <label>Select columns to display:</label>
                        <!-- Buttons to select or deselect all checkboxes -->
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary select-all-btn">Select All</button>
                            <button type="button" class="btn btn-secondary deselect-all-btn">Deselect All</button>

                        </div>

                        <div class="border p-3">
                            <% columns.forEach(column=> { %>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input column-checkbox" type="checkbox" name="columns"
                                        value="<%= column %>" <%=selectedColumns.includes(column) ? 'checked' : '' %>>
                                    <label class="form-check-label">
                                        <%= column %>
                                    </label>
                                </div>
                                <% }) %>

                                    <button type="submit" name="submit" class="btn btn-success" id="sendToAI">Show
                                        Selected Columns</button>
                                    <button type="button" class="btn btn-warning reset-columns-btn">Reset
                                        Columns</button>
                        </div>

                    </div>

                    <div class="form-group d-flex justify-content-between align-items-center">


                        <select id="rowsSelect" name="rows" class="form-control" style="width: auto;">
                            <option value="10" <%=req.query.rows=='10' ? 'selected' : '' %>>10</option>
                            <option value="20" <%=req.query.rows=='20' ? 'selected' : '' %>>20</option>
                            <option value="50" <%=req.query.rows=='50' ? 'selected' : '' %>>50</option>
                        </select>
                    </div>



                </form>
            </div>

        </div>
        <div class="col-md-6">
            <table class="table" id="dataTable">
                <thead>
                    <tr>
                        <% selectedColumns.forEach(column=> { %>
                            <th>
                                <%= column %>
                            </th>
                            <% }) %>
                    </tr>
                </thead>
                <tbody>
                    <% data.forEach((row, index) => { %>
                        <tr class="data-row"> <!-- Ensure this class is present -->
                            <% selectedColumns.forEach(column => { %>
                                <td><%= row[column] || '' %></td>
                            <% }) %>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const selectAllBtn = document.querySelector('.select-all-btn');
            const deselectAllBtn = document.querySelector('.deselect-all-btn');
            const resetColumnsBtn = document.querySelector('.reset-columns-btn');
            const checkboxes = document.querySelectorAll('.column-checkbox');
            const rowsSelect = document.getElementById('rowsSelect');
            const dataRows = document.querySelectorAll('tr.data-row'); // Assuming each data row has 'data-row' class

            // Function to update the visibility of data rows based on the selected number of rows
            const updateVisibleRows = () => {
                const numRowsToShow = parseInt(rowsSelect.value, 10);
                dataRows.forEach((row, index) => {
                    row.style.display = index < numRowsToShow ? '' : 'none';
                });
            };

            // Event listener for the 'Select All' button
            selectAllBtn.addEventListener('click', () => {
                checkboxes.forEach(checkbox => checkbox.checked = true);
            });

            // Event listener for the 'Deselect All' button
            deselectAllBtn.addEventListener('click', () => {
                checkboxes.forEach(checkbox => checkbox.checked = false);
            });

            // Event listener for the 'Reset Columns' button
            resetColumnsBtn.addEventListener('click', () => {
                window.location.href = '/dashboard'; // Redirect without any query parameters
            });

            // Event listener for any change in the checkboxes
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    // This could be modified if you decide to keep the form submission for column filtering
                    // For now, we'll leave it as it directly affects visibility without submission
                });
            });

            // Adjust visibility of data rows when the selection changes
            rowsSelect.addEventListener('change', updateVisibleRows);

            // Initial adjustment of data rows visibility based on the default selection
            updateVisibleRows();
        });


    </script>

</body>

</html>